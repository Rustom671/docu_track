{% import "bootstrap/wtf.html" as wtf %}
{% block content %}
{% include "header_test.html" %}
<div class="container-fluid">
    <div class="row">
        <div class="col-xl-2 col-lg-2 col-md-3 col-sm-3 col-2 bg-light shadow min-vh-100">
        {% include "sidebar.html" %}
        </div>
        <div class="col-xl-10 col-lg-10 col-md-9 col-sm-9 col-10">
            <div class="py-3 px-lg-3 px-md-2 px-sm-3 px-xs-3" >
                <div class="row px-sm-2 px-0 bg-light shadow p-3 rounded mb-3">
                    <div class = "col mb-3 d-flex justify-content-between">
                         <div class="name">
                            <h5 style="color: #fca650">Details</h5>
                        </div>
                        <div class="name">
                            <a class="btn btn-labeled btn-warning shadow" href="{{ url_for('edit_case', case_no=case.case_no) }}">
                                <i class="bi bi-pencil-square"></i> <span class="ms-1 d-none d-sm-inline">Edit</span>
                            </a>
                        </div>
                    </div>
                    <hr>
                    <div class = "d-flex justify-content-between">
                        <strong><p style="color: #12632a">Case Number: {{ case.case_no }}</p></strong>
                        <p class="nav-link">Status: {{ case.status }}</p>
                    </div>
                    <hr>
                    <div>
                        <p class="nav-link">Case Title: {{ case.case_title }}</p>
                    </div>
                    <div class="d-md-flex">
                        <div class = "col">
                            <p class="nav-link"><i class="bi bi-person-badge"></i> Complainant: <strong>{{ case.case_complainant }}</strong></p>
                            <p class="nav-link"><i class="bi bi-geo-alt-fill"></i> Address of Complainant: <strong>{{ case.address_complainant }}</strong></p>
                            <p class="nav-link"><i class="bi bi-telephone-fill"></i> Contact Information of Complainant: <strong>{{ case.contact_complainant }}</strong></p>
                        </div>
                        <div class = "col">
                            <p class="nav-link"><i class="bi bi-person-badge"></i> Respondent: <strong>{{ case.case_respondent }}</strong></p>
                            <p class="nav-link"><i class="bi bi-geo-alt-fill"></i> Address of Respondent: <strong>{{ case.address_respondent }}</strong></p>
                            <p class="nav-link"><i class="bi bi-telephone-fill"></i> Contact Information of Respondent: <strong>{{ case.contact_respondent }}</strong></p>
                        </div>
                    </div>
                    <div class="d-flex">
                        <p class="nav-link"><i class="bi bi-pin-map-fill"></i> Location of Subject Structure: <strong>{{case.location}},</strong></p>
                        <p class="nav-link"><strong> &nbsp;{{case.barangay}}</strong></p>
                    </div>
    <!--                    <h3>Document</h3>-->
    <!--                    <div class="d-flex justify-content-between px-3">-->
    <!--                        <div class="mr-3">-->
    <!--                            <button class="btn btn-labeled btn-warning shadow" id="showDocumentBtn">Show Investigation Report</button>-->
    <!--                        </div>-->
    <!--                        <div class="mr-3">-->
    <!--                            <button class="btn btn-labeled btn-warning shadow">Upload Resolution</button>-->
    <!--                        </div>-->
    <!--                        <div class="mr-3">-->
    <!--                            <button class="btn btn-labeled btn-warning shadow">Upload Position Papers</button>-->
    <!--                        </div>-->
    <!--                    </div>-->
                </div>
                <div class="row px-sm-2 px-0 bg-light shadow p-3 rounded mb-3">
                        <div class=" px-sm-2 px-0 p-3 rounded mb-3">
                            <div class = "col mb-3 d-flex justify-content-between">
                                 <div class="name">
                                    <h5 style="color: #fca650">Documents</h5>
                                </div>
                                <div class="name">
                                    <a class="btn btn-labeled btn-warning shadow" data-bs-toggle="modal" data-bs-target="#addDoc">
                                        <i class="fa fa-plus"></i> <span class="ms-1 d-none d-sm-inline">Add Document</span>
                                    </a>
                                </div>
                            </div>
                            <div class="card">
                                 {% for document in docu %}
                                    <button type="button" class="btn btn-light btn-align-left show-document" data-file-path="{{ document.file_path }}">
                                        {% if document.document_type == "Investigation Report" %}
                                            <i class="bi bi-binoculars-fill"></i>
                                        {% elif document.document_type == "Resolution" %}
                                            <i class="bi bi-file-earmark-check-fill"></i>
                                        {% elif document.document_type == "Minutes of Meeting" %}
                                            <i class="bi bi-file-earmark-text-fill"></i>
                                        {% elif document.document_type == "Audio File" %}
                                            <i class="bi bi-mic-fill"></i>
                                        {% elif document.document_type == "Position Paper" %}
                                            <i class="bi bi-folder-fill"></i>
                                        {% endif %}
                                        {{ document.document_type }}
                                    </button>
                                {% endfor %}
                            </div>
                        </div>
                    <div>
                     {% with messages = get_flashed_messages() %}
                       {% if messages %}
                         {% for message in messages %}
                            <div class="d-flex justify-content-center" id="triggerModalDiv">
                                <p id="messageText" style="color: red; display: none">{{ message }}</p>
                            </div>
                         {% endfor %}
                       {% endif %}
                     {% endwith %}
                    </div>
                    <!-- Modal to display-->
                    <div class="modal fade" id="pdfModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h1 class="modal-title fs-5" id="exampleModalLabel">Files</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">
                              <div id="uploadForm" style="display: none;">
                                <!-- HTML form for uploading resolution -->
                                <form action="/upload_resolution" method="POST" enctype="multipart/form-data">
                                    <input type="file" name="resolutionFile">
                                    <input type="submit" value="Upload Resolution">
                                </form>
                            </div>
                            <iframe id="pdfViewerModal" width="100%" height="800px"></iframe>
                          </div>
    <!--                          <div class="modal-footer">-->
    <!--                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>-->
    <!--                            <button type="button" class="btn btn-primary">Save changes</button>-->
    <!--                          </div>-->
                        </div>
                      </div>
                    </div>

                     <!-- Modal to add document-->
                    <div class="modal fade" id="addDoc" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h1 class="modal-title fs-5">Add Files</h1>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                          </div>
                          <div class="modal-body">

                                <!-- HTML form for uploading files-->
                                <form method="POST" id="myForm" enctype="multipart/form-data">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                    {% for field in form %}
                                        {% if field.name == 'file_type' %}
                                            <label>File Type</label>
                                            <div class="form-floating mb-3 px-2 light-label">
                                                {{ field(class="form-select", id="FileType") }}
                                            </div>
                                        {% elif field.name == 'files' %}

                                            <div class="mb-3">
                                                {{ field.label(for="formFile", class="form-label") }}
                                                {{ field(class="form-control", id="formFile", type="file") }}
                                            </div>

                                        {% endif %}
                                    {% endfor %}

                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                        <button type="submit" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#FlashMessage">Save changes</button>
                                    </div>
                                </form>

                          </div>
                        </div>
                      </div>
                    </div>

                    <script>
                        document.addEventListener("DOMContentLoaded", function () {
                        const showDocumentButtons = document.querySelectorAll('.show-document');

                            showDocumentButtons.forEach(button => {
                                button.addEventListener('click', () => {
                                    const filePath = button.getAttribute('data-file-path');

                                    // Open the modal
                                    $(pdfModal).modal('show');

                                    // Load and display the PDF in the modal's iframe
                                    pdfViewerModal.src = filePath;
                                });
                            });
                        });
                    </script>
                </div>
            </div>
        </div>
    </div>
</div>


<!-- Add this JavaScript code after your content -->
<script>

window.onload = function () {
    var message = document.getElementById('messageText').textContent;
    // Check if the element with id "triggerModalDiv" exists
    if ($('#triggerModalDiv').length) {
        var icon = "success"; // Default icon is "success"
        var goodjob = "Good Job!"
        // Check if the message contains the word "error" or "failed" (you can adjust this condition as needed)
        if (message.toLowerCase().includes("error") || message.toLowerCase().includes("extension")) {
            icon = "error"; // Change the icon to "error" for error messages
            goodjob = "Oops!"
        }

        // Trigger the SweetAlert with the determined icon
        swal.fire({
            title: goodjob,
            text: message,
            icon: icon, // Use the determined icon
        });
    }
};

</script>

{% include "javascript.html" %}
{% endblock %}
