{% import "bootstrap/wtf.html" as wtf %}
{% block content %}
{% include "header_test.html" %}
<div class="container-fluid">
    <div class="row flex-nowrap">
        <div class="col-xl-2 col-lg-2 col-md-3 col-2 bg-dark shadow min-vh-100 position-fixed d-inline-block">
            {% include "sidebar.html" %}
        </div>
        <div class="col-xl-10 col-lg-10 col-md-9 col-10 offset-xl-2 offset-lg-2 offset-md-3 offset-2 mt-3">
            <div class="py-3 px-lg-3 px-md-2 px-sm-2 px-xs-2" >
                <div class="col-auto px-sm-3 px-0 bg-light shadow p-2 rounded mb-3">
                    <h3>Add Employee</h3>
                        <form id="myForm" method="POST" action="{{ url_for('add_new_employee') }}">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
                                <div class="d-flex col-sm-12 justify-content-start p-2">
                                    <h5 style="color: #fca650">Details</h5>
                                </div>
                                <div class="row bd-highlight">
                                {% for field in form %}
                                    {% if field.name == 'emp_lname' %}
                                        <div class="bd-highlight col-md-4">
                                            <div class="form-floating mb-3 light-label">
                                                <input class="form-control" id="LastName" type="text" placeholder="Last Name" name="{{ field.name }}" required="True">
                                                    <label for="LastName">Last Name</label>
                                                    {% for error in form.emp_lname.errors %}
                                                        <p class="error" style="color: red">{{ error }}</p>
                                                    {% endfor %}
                                            </div>
                                        </div>
                                    {% elif field.name == 'emp_fname' %}
                                        <div class="bd-highlight col-md-4">
                                            <div class="form-floating mb-3 light-label">
                                                <input class="form-control" id="FirstName" type="text" placeholder="First Name" name="{{ field.name }}" required="True">
                                                    <label for="FirstName">First Name</label>
                                                    {% for error in form.emp_fname.errors %}
                                                        <p class="error" style="color: red">{{ error }}</p>
                                                    {% endfor %}
                                            </div>
                                        </div>
                                    {% elif field.name == 'emp_mname' %}
                                        <div class="bd-highlight col-md-4">
                                            <div class="form-floating mb-3 light-label">
                                                <input class="form-control" id="MiddleInitial" type="text" placeholder="Middle Initial" name="{{ field.name }}" required="True">
                                                    <label for="MiddleInitial">Middle Initial</label>
                                                    {% for error in form.emp_mname.errors %}
                                                        <p class="error" style="color: red">{{ error }}</p>
                                                    {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}  {# Closing the if condition properly #}
                                {% endfor %}
                                </div>

                                <div class="row bd-highlight">
                                    {% for field in form %}
                                        {% if field.name == 'emp_position' %}
                                            <div class="bd-highlight col-md-6">
                                                <div class="form-floating mb-3 light-label">
                                                    {{ field(class="form-select", id="Position") }}
                                                    <label for="Position">Position</label>
                                                    {% for error in form.emp_position.errors %}
                                                        <p class="error" style="color: red">{{ error }}</p>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% elif field.name == 'emp_division' %}
                                            <div class="bd-highlight col-md-6">
                                                <div class="form-floating mb-3 light-label">
                                                    {{ field(class="form-select", id="Division") }}
                                                    <label for="Division">Division</label>
                                                    {% for error in form.emp_division.errors %}
                                                        <p class="error" style="color: red">{{ error }}</p>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                        {% endif %}
                                    {% endfor %}
                                </div>

                            <div class="row bd-highlight">
                                {% for field in form %}
                                    {% if field.name == 'emp_gender' %}
                                        <div class="bd-highlight col-md-6">
                                            <div class="form-floating mb-3 light-label">
                                                {{ field(class="form-select", id="Gender") }}
                                                <label for="Gender">Gender</label>
                                                {% for error in form.emp_gender.errors %}
                                                    <p class="error" style="color: red">{{ error }}</p>
                                                {% endfor %}
                                            </div>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>


                            <div class="d-flex name justify-content-end">
                                <button type="submit" class="btn btn-warning">Save</button>
                            </div>
                        </form>
                    <div class="row">
                     {% with messages = get_flashed_messages() %}
                       {% if messages %}
                         {% for message in messages %}
                            <div class="d-flex justify-content-center" id="triggerModalDiv">
                                <p id="messageText" style="color: red; display: none">{{ message }}</p>
                            </div>
                         {% endfor %}
                       {% endif %}
                     {% endwith %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal to display flash message-->
<div class="modal fade" id="FlashMessage" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="modal-title fs-5">Alert</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </form>

      </div>
    </div>
  </div>
</div>

<!-- Add this JavaScript code after your content -->
<script>


window.onload = function () {
    var message = document.getElementById('messageText').textContent;

    // Check if the element with id "triggerModalDiv" exists
    if ($('#triggerModalDiv').length) {
        var icon = "success"; // Default icon is "success"
        var goodjob = "Good Job!"
        // Check if the message contains the word "error" or "failed" (you can adjust this condition as needed)
        if (message.toLowerCase().includes("error") || message.toLowerCase().includes("exist")) {
            icon = "error"; // Change the icon to "error" for error messages
            goodjob = "Oops!"
        }

        // Trigger the SweetAlert with the determined icon
        swal.fire({
            title: goodjob,
            text: message,
            icon: icon, // Use the determined icon
        });
    }
};

let formSubmitted = false;

// Restore input values from Local Storage on page load
document.addEventListener('DOMContentLoaded', function() {
    for (let field of document.querySelectorAll('input, textarea')) {
        if (field.name) {
            let storedValue = localStorage.getItem(field.name);
            if (storedValue !== null) {
                field.value = storedValue;
            }
        }
    }
});

// Save input values to Local Storage on form submit
document.getElementById('myForm').addEventListener('submit', function() {
    formSubmitted = true;
    for (let field of document.querySelectorAll('input, textarea')) {
        if (field.name) {
            localStorage.setItem(field.name, field.value);
        }
    }
});

// Clear local storage data when leaving the page
window.addEventListener('beforeunload', function() {
    if (!formSubmitted) {
        for (let field of document.querySelectorAll('input, textarea')) {
            if (field.name) {
                localStorage.removeItem(field.name);
            }
        }
    }
});

// Clear local storage data when refreshing the page
window.addEventListener('unload', function() {
    if (!formSubmitted) {
        for (let field of document.querySelectorAll('input, textarea')) {
            if (field.name) {
                localStorage.removeItem(field.name);
            }
        }
    }
});

</script>

{% include "javascript.html" %}
{% endblock %}